<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>awscli on Tech Memory</title><link>/tags/awscli/</link><description>Recent content in awscli on Tech Memory</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sat, 23 Jan 2021 00:00:00 +0800</lastBuildDate><atom:link href="/tags/awscli/index.xml" rel="self" type="application/rss+xml"/><item><title>AWS CLI Cheatsheet</title><link>/cheatsheets/aws-cli/</link><pubDate>Sat, 23 Jan 2021 00:00:00 +0800</pubDate><guid>/cheatsheets/aws-cli/</guid><description>aws configure # aws cli related environement variables export AWS_PROFILE= export AWS_ACCESS_KEY_ID= export AWS_SECRET_ACCESS_KEY= export AWS_SESSION_TOKEN= export AWS_REGION=ap-southeast-1 export AWS_DEFAULT_OUTPUT=json export AWS_DEFAULT_REGION=ap-southeast-1 aws sts # get current identity aws sts get-caller-identity # assume role and set credentials to env variables, with jq ROLE_ARN=arn:aws:iam::000000000000:role/your-role eval $(aws sts assume-role \ --role-arn ${ROLE_ARN} \ --role-session-name sess-name \ | jq -r &amp;#39;.Credentials | &amp;#34;export AWS_ACCESS_KEY_ID=\(.AccessKeyId) AWS_SECRET_ACCESS_KEY=\(.SecretAccessKey) AWS_SESSION_TOKEN=\(.SessionToken)&amp;#34;&amp;#39; ) # assume role and set credentials to env variables, with sed &amp;amp; awk ROLE_ARN=arn:aws:iam::000000000000:role/your-role eval $(aws sts assume-role \ --role-arn ${ROLE_ARN} \ --role-session-name sess-name \ | egrep &amp;#39;(SecretAccessKey|SessionToken|AccessKeyId)&amp;#39; \ | awk -F&amp;#39;&amp;#34;&amp;#39; &amp;#39;{print &amp;#34;export AWS&amp;#34;toupper(gensub(/([A-Z])/, &amp;#34;_\\1&amp;#34;, &amp;#34;g&amp;#34;,$2))&amp;#34;=&amp;#34;$4}&amp;#39; ) aws ec2 # login to ec2 shell via session manager aws ssm start-session --target i-aaaaaaaaaaaaaaaaaa # port-forward aws s3 # list bucket aws s3 ls # rename folder aws s3 --recursive mv s3://your-bucket/path/to/foo s3://your-bucket/path/to/bar aws eks # check web identity env | grep AWS_</description><content>&lt;h2 id="aws-configure">aws configure&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># aws cli related environement variables&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export AWS_PROFILE&lt;span style="color:#f92672">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export AWS_ACCESS_KEY_ID&lt;span style="color:#f92672">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export AWS_SECRET_ACCESS_KEY&lt;span style="color:#f92672">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export AWS_SESSION_TOKEN&lt;span style="color:#f92672">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export AWS_REGION&lt;span style="color:#f92672">=&lt;/span>ap-southeast-1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export AWS_DEFAULT_OUTPUT&lt;span style="color:#f92672">=&lt;/span>json
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export AWS_DEFAULT_REGION&lt;span style="color:#f92672">=&lt;/span>ap-southeast-1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="aws-sts">aws sts&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># get current identity&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws sts get-caller-identity
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># assume role and set credentials to env variables, with jq&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ROLE_ARN&lt;span style="color:#f92672">=&lt;/span>arn:aws:iam::000000000000:role/your-role
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>eval &lt;span style="color:#66d9ef">$(&lt;/span>aws sts assume-role &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --role-arn &lt;span style="color:#e6db74">${&lt;/span>ROLE_ARN&lt;span style="color:#e6db74">}&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --role-session-name sess-name &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> | jq -r &lt;span style="color:#e6db74">&amp;#39;.Credentials | &amp;#34;export AWS_ACCESS_KEY_ID=\(.AccessKeyId) AWS_SECRET_ACCESS_KEY=\(.SecretAccessKey) AWS_SESSION_TOKEN=\(.SessionToken)&amp;#34;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># assume role and set credentials to env variables, with sed &amp;amp; awk&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ROLE_ARN&lt;span style="color:#f92672">=&lt;/span>arn:aws:iam::000000000000:role/your-role
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>eval &lt;span style="color:#66d9ef">$(&lt;/span>aws sts assume-role &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --role-arn &lt;span style="color:#e6db74">${&lt;/span>ROLE_ARN&lt;span style="color:#e6db74">}&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --role-session-name sess-name &lt;span style="color:#ae81ff">\ &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> | egrep &lt;span style="color:#e6db74">&amp;#39;(SecretAccessKey|SessionToken|AccessKeyId)&amp;#39;&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> | awk -F&lt;span style="color:#e6db74">&amp;#39;&amp;#34;&amp;#39;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;{print &amp;#34;export AWS&amp;#34;toupper(gensub(/([A-Z])/, &amp;#34;_\\1&amp;#34;, &amp;#34;g&amp;#34;,$2))&amp;#34;=&amp;#34;$4}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="aws-ec2">aws ec2&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># login to ec2 shell via session manager&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws ssm start-session --target i-aaaaaaaaaaaaaaaaaa
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># port-forward&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="aws-s3">aws s3&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># list bucket&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws s3 ls
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># rename folder&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws s3 --recursive mv s3://your-bucket/path/to/foo s3://your-bucket/path/to/bar
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="aws-eks">aws eks&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># check web identity&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>env | grep AWS_
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></content></item></channel></rss>