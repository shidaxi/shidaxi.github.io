<!doctype html><html lang=en><head><title>AWS CLI Cheatsheet :: Tech Memory</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="aws configure # aws cli related environement variables export AWS_PROFILE= export AWS_ACCESS_KEY_ID= export AWS_SECRET_ACCESS_KEY= export AWS_SESSION_TOKEN= export AWS_REGION=ap-southeast-1  export AWS_DEFAULT_OUTPUT=json export AWS_DEFAULT_REGION=ap-southeast-1 cli output filtering For basic syntax, please refer to https://docs.aws.amazon.com/cli/latest/userguide/cli-usage-filter.html
This article only share some practical examples.
server side filtering with option &amp;ndash;filter Server-side filtering in the AWS CLI is provided by the AWS service API. The AWS service only returns the records in the HTTP response that match your filter, which can speed up HTTP response times for large data sets."><meta name=keywords content="aws,awscli,cheatsheet"><meta name=robots content="noodp"><link rel=canonical href=/cheatsheets/aws-cli/><link rel=stylesheet href=/assets/style.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/favicon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="AWS CLI Cheatsheet"><meta property="og:description" content="aws configure # aws cli related environement variables export AWS_PROFILE= export AWS_ACCESS_KEY_ID= export AWS_SECRET_ACCESS_KEY= export AWS_SESSION_TOKEN= export AWS_REGION=ap-southeast-1  export AWS_DEFAULT_OUTPUT=json export AWS_DEFAULT_REGION=ap-southeast-1 cli output filtering For basic syntax, please refer to https://docs.aws.amazon.com/cli/latest/userguide/cli-usage-filter.html
This article only share some practical examples.
server side filtering with option &amp;ndash;filter Server-side filtering in the AWS CLI is provided by the AWS service API. The AWS service only returns the records in the HTTP response that match your filter, which can speed up HTTP response times for large data sets."><meta property="og:url" content="/cheatsheets/aws-cli/"><meta property="og:site_name" content="Tech Memory"><meta property="og:image" content="/images/cover-aws-cli-cheatsheet.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2021-01-23 00:00:00 +0800 +0800"></head><body class=orange><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>tech @ memory: ~ $</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/>Posts</a></li><li><a href=/cheatsheets>Cheatsheets</a></li><li><a href=/tools>Tools</a></li><li><a href=/icon-collections>Icons</a></li><li><a href=/about>About</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/>Posts</a></li><li><a href=/cheatsheets>Cheatsheets</a></li><li><a href=/tools>Tools</a></li><li><a href=/icon-collections>Icons</a></li><li><a href=/about>About</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/cheatsheets/aws-cli/>AWS CLI Cheatsheet</a></h1><div class=post-meta><span class=post-date>2021-01-23</span></div><span class=post-tags>#<a href=/tags/aws/>aws</a>&nbsp;
#<a href=/tags/awscli/>awscli</a>&nbsp;
#<a href=/tags/cheatsheet/>cheatsheet</a>&nbsp;</span>
<img src=/images/cover-aws-cli-cheatsheet.png class=post-cover alt="AWS CLI Cheatsheet" title="Cover Image"><div class=table-of-contents><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#aws-configure>aws configure</a></li><li><a href=#cli-output-filtering>cli output filtering</a><ul><li><a href=#server-side-filtering-with-option---filter>server side filtering with option &ndash;filter</a></li><li><a href=#client-side-filtering-with-optioin---query>client side filtering with optioin &ndash;query</a></li><li><a href=#client-side-filtering-with-jq>Client Side Filtering with jq</a></li></ul></li><li><a href=#aws-sts>aws sts</a></li><li><a href=#aws-ec2>aws ec2</a></li><li><a href=#aws-s3>aws s3</a></li><li><a href=#aws-eks>aws eks</a></li><li><a href=#cloudfront>cloudfront</a></li></ul></nav></div><div class=post-content><div><h2 id=aws-configure>aws configure<a href=#aws-configure class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># aws cli related environement variables</span>
</span></span><span style=display:flex><span>export AWS_PROFILE<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>export AWS_ACCESS_KEY_ID<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>export AWS_SECRET_ACCESS_KEY<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>export AWS_SESSION_TOKEN<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>export AWS_REGION<span style=color:#f92672>=</span>ap-southeast-1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export AWS_DEFAULT_OUTPUT<span style=color:#f92672>=</span>json
</span></span><span style=display:flex><span>export AWS_DEFAULT_REGION<span style=color:#f92672>=</span>ap-southeast-1
</span></span></code></pre></div><h2 id=cli-output-filtering>cli output filtering<a href=#cli-output-filtering class=hanchor arialabel=Anchor>&#8983;</a></h2><p>For basic syntax, please refer to
<a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-usage-filter.html>https://docs.aws.amazon.com/cli/latest/userguide/cli-usage-filter.html</a></p><p>This article only share some practical examples.</p><h3 id=server-side-filtering-with-option---filter>server side filtering with option &ndash;filter<a href=#server-side-filtering-with-option---filter class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Server-side filtering in the AWS CLI is provided by the AWS service API. The AWS service only returns the records in the HTTP response that match your filter, which can speed up HTTP response times for large data sets. Since server-side filtering is defined by the service API, the parameter names and functions vary between services.</p><p><strong>Notice:</strong></p><ul><li>&ndash;filter and &ndash;filters does not support regular expressions.</li><li>&ndash;filter-expression does support expression, but only a few aws service support this option</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash></code></pre></div><h3 id=client-side-filtering-with-optioin---query>client side filtering with optioin &ndash;query<a href=#client-side-filtering-with-optioin---query class=hanchor arialabel=Anchor>&#8983;</a></h3><p>The AWS CLI provides built-in JSON-based client-side filtering capabilities with the &ndash;query parameter. The &ndash;query parameter is a powerful tool you can use to customize the content and style of your output. The &ndash;query parameter takes the HTTP response that comes back from the server and filters the results before displaying them. Since the entire HTTP response is sent to the client before filtering, client-side filtering can be slower than server-side filtering for large data-sets.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash></code></pre></div><h3 id=client-side-filtering-with-jq>Client Side Filtering with jq<a href=#client-side-filtering-with-jq class=hanchor arialabel=Anchor>&#8983;</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash></code></pre></div><h2 id=aws-sts>aws sts<a href=#aws-sts class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># get current identity</span>
</span></span><span style=display:flex><span>aws sts get-caller-identity
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># assume role and set credentials to env variables, with jq</span>
</span></span><span style=display:flex><span>ROLE_ARN<span style=color:#f92672>=</span>arn:aws:iam::000000000000:role/your-role
</span></span><span style=display:flex><span>eval <span style=color:#66d9ef>$(</span>aws sts assume-role <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --role-arn <span style=color:#e6db74>${</span>ROLE_ARN<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --role-session-name sess-name <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        | jq -r <span style=color:#e6db74>&#39;.Credentials | &#34;export AWS_ACCESS_KEY_ID=\(.AccessKeyId) AWS_SECRET_ACCESS_KEY=\(.SecretAccessKey) AWS_SESSION_TOKEN=\(.SessionToken)&#34;&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># assume role and set credentials to env variables, with sed &amp; awk</span>
</span></span><span style=display:flex><span>ROLE_ARN<span style=color:#f92672>=</span>arn:aws:iam::000000000000:role/your-role
</span></span><span style=display:flex><span>eval <span style=color:#66d9ef>$(</span>aws sts assume-role <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --role-arn <span style=color:#e6db74>${</span>ROLE_ARN<span style=color:#e6db74>}</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        --role-session-name sess-name <span style=color:#ae81ff>\ </span>
</span></span><span style=display:flex><span>        | egrep <span style=color:#e6db74>&#39;(SecretAccessKey|SessionToken|AccessKeyId)&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        | awk -F<span style=color:#e6db74>&#39;&#34;&#39;</span> <span style=color:#e6db74>&#39;{print &#34;export AWS&#34;toupper(gensub(/([A-Z])/, &#34;_\\1&#34;, &#34;g&#34;,$2))&#34;=&#34;$4}&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>)</span>
</span></span></code></pre></div><h2 id=aws-ec2>aws ec2<a href=#aws-ec2 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># find ec2 with --filters</span>
</span></span><span style=display:flex><span>aws ec2 describe-instances <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --filters Name<span style=color:#f92672>=</span>instance-type,Values<span style=color:#f92672>=</span>t2.micro,t3.micro 
</span></span><span style=display:flex><span>              Name<span style=color:#f92672>=</span>availability-zone,Values<span style=color:#f92672>=</span>us-east-2c
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># find ec2 with --filters by tag</span>
</span></span><span style=display:flex><span>aws ec2 describe-instances <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --filters Name<span style=color:#f92672>=</span>tag:Owner,Values<span style=color:#f92672>=</span>my-team
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># find ec2 with --filters by tag</span>
</span></span><span style=display:flex><span>aws ec2 describe-instances <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --filters <span style=color:#e6db74>&#34;Name=tag:Owner,Values=my-team&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># get only useful information of ec2 instances wich both --filters and --query</span>
</span></span><span style=display:flex><span>aws ec2 describe-instances <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --filters <span style=color:#e6db74>&#34;Name=tag:Owner,Values=my-team&#34;</span>
</span></span><span style=display:flex><span>    --query <span style=color:#e6db74>&#39;Reservations[*].Instances[*].{Instance:InstanceId, Name:Tags[?Key==`Name`]|[0].Value}&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># --output table makes outputs more human readable.</span>
</span></span></code></pre></div><p><img src=images/aws-cli-output-table-format.png alt="aws cli output table format"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># login to ec2 shell via session manager</span>
</span></span><span style=display:flex><span>aws ssm start-session --target i-aaaaaaaaaaaaaaaaaa
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># port-forward</span>
</span></span></code></pre></div><h2 id=aws-s3>aws s3<a href=#aws-s3 class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># list bucket</span>
</span></span><span style=display:flex><span>aws s3 ls
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># rename folder</span>
</span></span><span style=display:flex><span>aws s3 --recursive mv s3://your-bucket/path/to/foo s3://your-bucket/path/to/bar
</span></span></code></pre></div><h2 id=aws-eks>aws eks<a href=#aws-eks class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># check web identity</span>
</span></span><span style=display:flex><span>env | grep AWS_
</span></span></code></pre></div><h2 id=cloudfront>cloudfront<a href=#cloudfront class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># list distributions with id, aliases, domian name and origin</span>
</span></span><span style=display:flex><span>aws cloudfront list-distributions | jq  <span style=color:#e6db74>&#39;.DistributionList.Items[] | {&#34;Id&#34;: .Id, &#34;Aliases&#34;: .Aliases.Items, &#34;Domain&#34;: .DomainName, &#34;Origin&#34;: .Origins.Items[0].DomainName}&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># create an invalidation, clear cache</span>
</span></span><span style=display:flex><span>aws cloudfront create-invalidation distribution-id
</span></span></code></pre></div></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script>
<script src=/assets/prism.js></script></div></body></html>