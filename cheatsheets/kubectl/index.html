<!doctype html><html lang=en><head><title>:: Tech Memory</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Kubectl Cheatsheet Docs:
 https://kubernetes.io/docs/reference/kubectl/cheatsheet/ https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands https://erosb.github.io/post/json-patch-vs-merge-patch/  Viewing, finding resources # get resource sort by name kubectl get services --sort-by=.metadata.name Troubleshoot Run a debugger pod / deployment # run a mysql client pod to troubleshoot database issue: kubectl run myclient --rm -i --tty --image mysql:5.7 -- bash # run a postgres client pod to troubleshoot database issue: kubectl run pgclient --rm -i --tty --image postgres:13-alpine -- bash # run a mongo client pod to troubleshoot mongodb issue: kubectl run mongoclient --rm -i --tty --image mongo:5 -- bash # run a busybox pod to troubleshoot network or http issue kubectl run debugger --rm -i --tty --image nicolaka/netshoot:latest -- bash # run a netshoot pod to troubleshoot network or http issue kubectl run debugger --rm -i --tty --image nicolaka/netshoot:latest -- bash Temporarily Change Resource # disable healthcheck if you want to troubleshoot healthcheck failure # --type json, use json patch(RFC 6902), check official docs kubectl patch deployment nginx --type json -p=&amp;#39;[{&amp;#34;op&amp;#34;: &amp;#34;remove&amp;#34;, &amp;#34;path&amp;#34;: &amp;#34;/spec/template/spec/containers/0/livenessProbe&amp;#34;}]&amp;#39; # change &amp;#34;command&amp;#34; to &amp;#34;sleep 1000&amp;#34; to troubleshoot entrypoint command error kubectl patch deployment nginx --type json -p=&amp;#39;[{&amp;#34;op&amp;#34;: &amp;#34;replace&amp;#34;, &amp;#34;path&amp;#34;: &amp;#34;/spec/template/spec/containers/0/command&amp;#34;, &amp;#34;value&amp;#34;:[&amp;#34;sleep&amp;#34;, &amp;#34;1000&amp;#34;]}]&amp;#39; # change image to troubleshoot software version issue kubectl patch deployment nginx --type=&amp;#39;json&amp;#39; -p=&amp;#39;[{&amp;#34;op&amp;#34;: &amp;#34;replace&amp;#34;, &amp;#34;path&amp;#34;: &amp;#34;/spec/template/spec/containers/0/image&amp;#34;, &amp;#34;value&amp;#34;:&amp;#34;nginx:1."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/cheatsheets/kubectl/><link rel=stylesheet href=/assets/style.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/favicon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content><meta property="og:description" content="Kubectl Cheatsheet Docs:
 https://kubernetes.io/docs/reference/kubectl/cheatsheet/ https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands https://erosb.github.io/post/json-patch-vs-merge-patch/  Viewing, finding resources # get resource sort by name kubectl get services --sort-by=.metadata.name Troubleshoot Run a debugger pod / deployment # run a mysql client pod to troubleshoot database issue: kubectl run myclient --rm -i --tty --image mysql:5.7 -- bash # run a postgres client pod to troubleshoot database issue: kubectl run pgclient --rm -i --tty --image postgres:13-alpine -- bash # run a mongo client pod to troubleshoot mongodb issue: kubectl run mongoclient --rm -i --tty --image mongo:5 -- bash # run a busybox pod to troubleshoot network or http issue kubectl run debugger --rm -i --tty --image nicolaka/netshoot:latest -- bash # run a netshoot pod to troubleshoot network or http issue kubectl run debugger --rm -i --tty --image nicolaka/netshoot:latest -- bash Temporarily Change Resource # disable healthcheck if you want to troubleshoot healthcheck failure # --type json, use json patch(RFC 6902), check official docs kubectl patch deployment nginx --type json -p=&amp;#39;[{&amp;#34;op&amp;#34;: &amp;#34;remove&amp;#34;, &amp;#34;path&amp;#34;: &amp;#34;/spec/template/spec/containers/0/livenessProbe&amp;#34;}]&amp;#39; # change &amp;#34;command&amp;#34; to &amp;#34;sleep 1000&amp;#34; to troubleshoot entrypoint command error kubectl patch deployment nginx --type json -p=&amp;#39;[{&amp;#34;op&amp;#34;: &amp;#34;replace&amp;#34;, &amp;#34;path&amp;#34;: &amp;#34;/spec/template/spec/containers/0/command&amp;#34;, &amp;#34;value&amp;#34;:[&amp;#34;sleep&amp;#34;, &amp;#34;1000&amp;#34;]}]&amp;#39; # change image to troubleshoot software version issue kubectl patch deployment nginx --type=&amp;#39;json&amp;#39; -p=&amp;#39;[{&amp;#34;op&amp;#34;: &amp;#34;replace&amp;#34;, &amp;#34;path&amp;#34;: &amp;#34;/spec/template/spec/containers/0/image&amp;#34;, &amp;#34;value&amp;#34;:&amp;#34;nginx:1."><meta property="og:url" content="/cheatsheets/kubectl/"><meta property="og:site_name" content="Tech Memory"><meta property="og:image" content="/favicon.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"></head><body class=orange><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>tech @ memory: ~ $</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/>Posts</a></li><li><a href=/cheatsheets>Cheatsheets</a></li><li><a href=/tools>Tools</a></li><li><a href=/icon-collections>Icons</a></li><li><a href=/about>About</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/>Posts</a></li><li><a href=/cheatsheets>Cheatsheets</a></li><li><a href=/tools>Tools</a></li><li><a href=/icon-collections>Icons</a></li><li><a href=/about>About</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/cheatsheets/kubectl/></a></h1><div class=post-meta></div><div class=table-of-contents><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#viewing-finding-resources>Viewing, finding resources</a></li><li><a href=#troubleshoot>Troubleshoot</a><ul><li></li></ul></li><li><a href=#test-kubernetes-features>Test Kubernetes Features</a><ul><li></li></ul></li><li><a href=#useful-resource-templates--snippets>Useful resource templates / snippets</a></li><li><a href=#awesome-kubernetes>Awesome Kubernetes</a><ul><li></li></ul></li></ul></nav></div><div class=post-content><div><h1 id=kubectl-cheatsheet>Kubectl Cheatsheet<a href=#kubectl-cheatsheet class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Docs:</p><ul><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/>https://kubernetes.io/docs/reference/kubectl/cheatsheet/</a></li><li><a href=https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands>https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands</a></li><li><a href=https://erosb.github.io/post/json-patch-vs-merge-patch/>https://erosb.github.io/post/json-patch-vs-merge-patch/</a></li></ul><h2 id=viewing-finding-resources>Viewing, finding resources<a href=#viewing-finding-resources class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># get resource sort by name</span>
</span></span><span style=display:flex><span>kubectl get services --sort-by<span style=color:#f92672>=</span>.metadata.name
</span></span></code></pre></div><h2 id=troubleshoot>Troubleshoot<a href=#troubleshoot class=hanchor arialabel=Anchor>&#8983;</a></h2><h4 id=run-a-debugger-pod--deployment>Run a debugger pod / deployment<a href=#run-a-debugger-pod--deployment class=hanchor arialabel=Anchor>&#8983;</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># run a mysql client pod to troubleshoot database issue:</span>
</span></span><span style=display:flex><span>kubectl run myclient --rm -i --tty --image mysql:5.7 -- bash
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># run a postgres client pod to troubleshoot database issue:</span>
</span></span><span style=display:flex><span>kubectl run pgclient --rm -i --tty --image postgres:13-alpine -- bash
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># run a mongo client pod to troubleshoot mongodb issue:</span>
</span></span><span style=display:flex><span>kubectl run mongoclient --rm -i --tty --image mongo:5 -- bash
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># run a busybox pod to troubleshoot network or http issue</span>
</span></span><span style=display:flex><span>kubectl run debugger --rm -i --tty --image nicolaka/netshoot:latest -- bash
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># run a netshoot pod to troubleshoot network or http issue</span>
</span></span><span style=display:flex><span>kubectl run debugger --rm -i --tty --image nicolaka/netshoot:latest -- bash
</span></span></code></pre></div><h4 id=temporarily-change-resource>Temporarily Change Resource<a href=#temporarily-change-resource class=hanchor arialabel=Anchor>&#8983;</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># disable healthcheck if you want to troubleshoot healthcheck failure</span>
</span></span><span style=display:flex><span><span style=color:#75715e># --type json, use json patch(RFC 6902), check official docs</span>
</span></span><span style=display:flex><span>kubectl patch deployment nginx --type json -p<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;[{&#34;op&#34;: &#34;remove&#34;, &#34;path&#34;: &#34;/spec/template/spec/containers/0/livenessProbe&#34;}]&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># change &#34;command&#34; to &#34;sleep 1000&#34; to troubleshoot entrypoint command error</span>
</span></span><span style=display:flex><span>kubectl patch deployment nginx --type json -p<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;[{&#34;op&#34;: &#34;replace&#34;, &#34;path&#34;: &#34;/spec/template/spec/containers/0/command&#34;, &#34;value&#34;:[&#34;sleep&#34;, &#34;1000&#34;]}]&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># change image to troubleshoot software version issue</span>
</span></span><span style=display:flex><span>kubectl patch deployment nginx --type<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;json&#39;</span> -p<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;[{&#34;op&#34;: &#34;replace&#34;, &#34;path&#34;: &#34;/spec/template/spec/containers/0/image&#34;, &#34;value&#34;:&#34;nginx:1.21&#34;}]&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># or with set image sub cmd</span>
</span></span><span style=display:flex><span>kubectl set image deployment/nginx nginx<span style=color:#f92672>=</span>nginx:1.21 <span style=color:#75715e># {containerName}=${image}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># scale a deployment</span>
</span></span><span style=display:flex><span>kubectl scale --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> deploy/nginx
</span></span><span style=display:flex><span><span style=color:#75715e># scale a statefulset</span>
</span></span><span style=display:flex><span>kubectl scale --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> statefulset/nginx
</span></span><span style=display:flex><span><span style=color:#75715e># scale multiple deployments</span>
</span></span><span style=display:flex><span>kubectl scale --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> deploy/nginx1 deploy/nginx2 deploy/nginx3
</span></span><span style=display:flex><span><span style=color:#75715e># scale with kubctl patch</span>
</span></span><span style=display:flex><span>kubectl patch deploy nginx --patch <span style=color:#e6db74>&#39;{&#34;spec&#34;: {&#34;replicas&#34;: 2}}&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># restart container inside your pod without chaging pod name and pod ip</span>
</span></span><span style=display:flex><span>kubectl exec -it nginx-0 -- /bin/sh -c <span style=color:#e6db74>&#34;kill 1&#34;</span>
</span></span></code></pre></div><h2 id=test-kubernetes-features>Test Kubernetes Features<a href=#test-kubernetes-features class=hanchor arialabel=Anchor>&#8983;</a></h2><h4 id=run-a-test-deployment>Run a test Deployment<a href=#run-a-test-deployment class=hanchor arialabel=Anchor>&#8983;</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># run a test nginx deployment</span>
</span></span><span style=display:flex><span>kubectl create deployment nginx --image<span style=color:#f92672>=</span>nginx
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># delete</span>
</span></span><span style=display:flex><span>kubectl delete deploy nginx
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># run a test busybox deployment</span>
</span></span><span style=display:flex><span>kubectl create deployment busybox --image<span style=color:#f92672>=</span>busybox -- sleep <span style=color:#ae81ff>1000</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># delete</span>
</span></span><span style=display:flex><span>kubectl delete deploy busybox 
</span></span></code></pre></div><h4 id=create-yaml-objects-from-stdin>Create yaml objects from stdin<a href=#create-yaml-objects-from-stdin class=hanchor arialabel=Anchor>&#8983;</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># create nginx statefulset</span>
</span></span><span style=display:flex><span>export APP_NAME<span style=color:#f92672>=</span>nginx
</span></span><span style=display:flex><span>export IMAGE<span style=color:#f92672>=</span>nginx:latest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: ${APP_NAME}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    app: ${APP_NAME}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - port: 80
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: web
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  clusterIP: None
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  selector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    app: ${APP_NAME}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: StatefulSet
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: ${APP_NAME}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  serviceName: ${APP_NAME}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  replicas: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  selector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      app: ${APP_NAME}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  template:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        app: ${APP_NAME}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      containers:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - name: ${APP_NAME}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        image: ${IMAGE}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - containerPort: 80
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          name: web
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#         volumeMounts:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#         - name: www
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#           mountPath: /usr/share/nginx/html
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#   volumeClaimTemplates:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#   - metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#       name: www
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#     spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#       accessModes: [ &#34;ReadWriteOnce&#34; ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#       resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#         requests:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>#           storage: 1Gi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h2 id=useful-resource-templates--snippets>Useful resource templates / snippets<a href=#useful-resource-templates--snippets class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml></code></pre></div><h2 id=awesome-kubernetes>Awesome Kubernetes<a href=#awesome-kubernetes class=hanchor arialabel=Anchor>&#8983;</a></h2><h4 id=k9s>k9s<a href=#k9s class=hanchor arialabel=Anchor>&#8983;</a></h4><p><a href=https://github.com/derailed/k9s>k9s</a>: Terminal Graphical UI</p><h4 id=kubectx>kubectx<a href=#kubectx class=hanchor arialabel=Anchor>&#8983;</a></h4><p><a href=https://github.com/ahmetb/kubectx>kubectx</a>: Kube Context Switcher</p><h4 id=kubectx-1>kubectx<a href=#kubectx-1 class=hanchor arialabel=Anchor>&#8983;</a></h4><p><a href=https://github.com/instrumenta/kubeval>kubeval</a>: Validate Your K8S Yaml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubeval /tmp/a.yaml 
</span></span><span style=display:flex><span>PASS - /tmp/a.yaml contains a valid Service <span style=color:#f92672>(</span>nginx<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PASS - /tmp/a.yaml contains a valid StatefulSet <span style=color:#f92672>(</span>nginx<span style=color:#f92672>)</span>
</span></span></code></pre></div></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script>
<script src=/assets/prism.js></script></div></body></html>